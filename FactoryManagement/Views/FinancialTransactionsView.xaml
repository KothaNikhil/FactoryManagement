<UserControl x:Class="FactoryManagement.Views.FinancialTransactionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    
    <Grid>
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title -->
            <!-- <TextBlock Grid.Row="0" Text="Financial Transactions &amp; Loan Management" 
                       FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/> -->

            <!-- Summary Cards -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Loans Given Card -->
                <Border Grid.Column="0" Background="#3d8b5f" CornerRadius="8" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="2" BlurRadius="8"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="ðŸ’°" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Loans Given" Foreground="#90EE90" FontSize="11" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalLoansGiven, StringFormat='â‚¹{0:N2}'}" 
                                       Foreground="White" FontSize="20" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Loans Taken Card -->
                <Border Grid.Column="2" Background="#b85450" CornerRadius="8" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="2" BlurRadius="8"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="ðŸ’¸" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Loans Taken" Foreground="#FFB6C1" FontSize="11" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalLoansTaken, StringFormat='â‚¹{0:N2}'}" 
                                       Foreground="White" FontSize="20" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Interest Receivable Card -->
                <Border Grid.Column="4" Background="#4a90c8" CornerRadius="8" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="2" BlurRadius="8"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="ðŸ“ˆ" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Interest Receivable" Foreground="#ADD8E6" FontSize="11" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalInterestReceivable, StringFormat='â‚¹{0:N2}'}" 
                                       Foreground="White" FontSize="20" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Interest Payable Card -->
                <Border Grid.Column="6" Background="#d9a05b" CornerRadius="8" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="2" BlurRadius="8"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="ðŸ“‰" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Interest Payable" Foreground="#FFEAA7" FontSize="11" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding TotalInterestPayable, StringFormat='â‚¹{0:N2}'}" 
                                       Foreground="White" FontSize="20" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Action Section -->
            <Grid Grid.Row="2" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Create New Loan Section -->
                <Border Grid.Column="0" BorderBrush="#444" BorderThickness="1" CornerRadius="8" Background="#2a2a2a" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Border Grid.Row="0" Style="{StaticResource SectionHeader.Prominent}">
                            <StackPanel Style="{StaticResource SectionHeader}" Margin="0">
                                <Border Background="{StaticResource Card.Info}" Style="{StaticResource IconBadge}">
                                    <TextBlock Text="âž•" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Style="{StaticResource SectionHeader.Content}">
                                    <TextBlock Text="Create New Loan" Style="{StaticResource SectionHeader.Title}"/>
                                    <TextBlock Text="Record a new loan transaction" Style="{StaticResource SectionHeader.Subtitle}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Row 1: Party, Type, Amount, Rate -->
                        <Grid Grid.Row="1" Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Party" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <ComboBox ItemsSource="{Binding Parties}" 
                                          SelectedItem="{Binding SelectedParty, Mode=TwoWay}"
                                          DisplayMemberPath="Name"
                                          Style="{StaticResource ComboBox.Standard}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Loan Type" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <ComboBox ItemsSource="{Binding LoanTypes}" 
                                          SelectedItem="{Binding SelectedLoanType, Mode=TwoWay}"
                                          Style="{StaticResource ComboBox.Standard}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="4">
                                <TextBlock Text="Amount (â‚¹)" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <TextBox Text="{Binding LoanAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                         GotFocus="NumericTextBox_GotFocus"
                                         Style="{StaticResource TextBox.Standard}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="6">
                                <TextBlock Text="Rate (% p.a.)" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <TextBox Text="{Binding InterestRate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                         GotFocus="NumericTextBox_GotFocus"
                                         Style="{StaticResource TextBox.Standard}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Row 2: Start Date, Due Date, Notes -->
                        <Grid Grid.Row="2" Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Start Date" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <DatePicker SelectedDate="{Binding StartDate}" 
                                            Style="{StaticResource DatePicker.Standard}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Due Date (Optional)" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <DatePicker SelectedDate="{Binding DueDate}" 
                                            Style="{StaticResource DatePicker.Standard}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="4">
                                <TextBlock Text="Notes" 
                                         Style="{StaticResource MaterialDesignBody2TextBlock}"
                                         Margin="0,0,0,8"/>
                                <TextBox Text="{Binding LoanNotes, Mode=TwoWay}" 
                                         Style="{StaticResource TextBox.Standard}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Row 3: Create Loan Button -->
                        <Button Grid.Row="3" Content="Create Loan" 
                                Command="{Binding CreateLoanCommand}"
                                Style="{StaticResource Button.Primary}"
                                MinWidth="120"
                                HorizontalAlignment="Right"
                                ToolTip="Create a new loan with the specified party, amount, and interest rate"/>
                    </Grid>
                </Border>

                <!-- Record Payment Section -->
                <Border Grid.Column="2" BorderBrush="#444" BorderThickness="1" CornerRadius="8" Background="#2a2a2a" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Border Grid.Row="0" Style="{StaticResource SectionHeader.Prominent}">
                            <StackPanel Style="{StaticResource SectionHeader}" Margin="0">
                                <Border Background="{StaticResource Card.Success}" Style="{StaticResource IconBadge}">
                                    <TextBlock Text="ðŸ’³" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Style="{StaticResource SectionHeader.Content}">
                                    <TextBlock Text="Record Payment" Style="{StaticResource SectionHeader.Title}"/>
                                    <TextBlock Text="Apply payment to selected loan" Style="{StaticResource SectionHeader.Subtitle}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Selected Loan Info -->
                        <Border Grid.Row="1" Background="#1a1a1a" CornerRadius="6" Padding="14" Margin="0,0,0,16">
                            <StackPanel>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Selected Loan" Foreground="#AAA" FontSize="12" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding SelectedLoan.Party.Name, TargetNullValue='No loan selected'}" 
                                               FontWeight="SemiBold" Foreground="White" FontSize="15" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Outstanding:" Foreground="#AAA" FontSize="12" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding SelectedLoan.TotalOutstanding, StringFormat=' â‚¹{0:N2}', TargetNullValue=' â‚¹0.00'}" 
                                               Foreground="#FF6B6B" FontWeight="Bold" FontSize="15" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Payment Amount -->
                        <StackPanel Grid.Row="2" Margin="0,0,0,16">
                            <TextBlock Text="Payment Amount (â‚¹)" 
                                     Style="{StaticResource MaterialDesignBody2TextBlock}"
                                     Margin="0,0,0,8"/>
                            <TextBox Text="{Binding PaymentAmount, UpdateSourceTrigger=PropertyChanged}" 
                                     GotFocus="NumericTextBox_GotFocus"
                                     Style="{StaticResource TextBox.Standard}"/>
                        </StackPanel>

                        <!-- Action Button -->
                        <Button Grid.Row="4" Content="Record Payment" 
                                Command="{Binding RecordPaymentCommand}"
                                Background="#3d8b5f" 
                                Foreground="White" 
                                Height="38"
                                FontSize="13"
                                FontWeight="SemiBold"
                                BorderThickness="0"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                ToolTip="Apply this payment to the selected loan. Payment is allocated to interest first, then principal">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#1e7e34"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        CornerRadius="6" 
                                                        BorderThickness="0">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#176428"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Border>
            </Grid>

            <!-- Loans List and Transaction History -->
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Loans List -->
                <Border Grid.Column="0" BorderBrush="#444" BorderThickness="1" CornerRadius="8" Background="#2a2a2a">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header with Filter -->
                        <Border Grid.Row="0" Background="#1a1a1a" Padding="15" BorderBrush="#444" BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Style="{StaticResource SectionHeader}" Margin="0">
                                    <Border Background="{StaticResource Card.Info}" Style="{StaticResource IconBadge}">
                                        <TextBlock Text="ðŸ“‹" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Style="{StaticResource SectionHeader.Content}">
                                        <TextBlock Text="All Loans" Style="{StaticResource SectionHeader.Title}"/>
                                    </StackPanel>
                                </StackPanel>

                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <TextBlock Text="Status:" VerticalAlignment="Center" Foreground="#BBB" Margin="0,0,10,0"/>
                                    <ComboBox SelectedItem="{Binding FilterStatus}" Width="120" Height="30">
                                        <ComboBoxItem Content="All"/>
                                        <ComboBoxItem Content="Active"/>
                                        <ComboBoxItem Content="Closed"/>
                                        <ComboBoxItem Content="Overdue"/>
                                        <ComboBoxItem Content="PartiallyPaid"/>
                                    </ComboBox>
                                </StackPanel>

                                <Button Grid.Column="4" Content="ðŸ“Š Update Interest" 
                                        Command="{Binding UpdateInterestCommand}"
                                        Background="#d9a05b" 
                                        Foreground="White" 
                                        Padding="15,5"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Calculate and add accrued interest to the selected loan based on days elapsed since last calculation. Interest = (Principal Ã— Rate Ã— Days) / (365 Ã— 100)"/>

                                <Button Grid.Column="6" Content="ðŸ”„ Refresh" 
                                        Command="{Binding RefreshCommand}"
                                        Background="#4a90c8" 
                                        Foreground="White" 
                                        Padding="15,5"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Reload all loan data and refresh the summary cards"/>
                            </Grid>
                        </Border>

                        <!-- Loans DataGrid -->
                        <DataGrid Grid.Row="1" Style="{StaticResource Section.DataGrid}"
                                  ItemsSource="{Binding Loans}" 
                                  SelectedItem="{Binding SelectedLoan}"
                                  AutoGenerateColumns="False" 
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  CanUserAddRows="False"
                                  Background="Transparent"
                                  RowBackground="#2a2a2a"
                                  AlternatingRowBackground="#333"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  FontSize="13">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#1a1a1a"/>
                                    <Setter Property="Foreground" Value="#BBB"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="Padding" Value="10"/>
                                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                    <Setter Property="BorderBrush" Value="#444"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Party" Binding="{Binding Party.Name}" Width="150"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding LoanType}" Width="80"/>
                                <DataGridTextColumn Header="Original Amount" Binding="{Binding OriginalAmount, StringFormat=â‚¹{0:N2}}" Width="130"/>
                                <DataGridTextColumn Header="Rate %" Binding="{Binding InterestRate, StringFormat={}{0:N2}%}" Width="80"/>
                                <DataGridTextColumn Header="Outstanding" Binding="{Binding TotalOutstanding, StringFormat=â‚¹{0:N2}}" Width="130"/>
                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                <DataGridTextColumn Header="Start Date" Binding="{Binding StartDate, StringFormat=dd-MMM-yyyy}" Width="110"/>
                                <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat=dd-MMM-yyyy}" Width="110"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>

                <!-- Transaction History -->
                <Border Grid.Column="2" BorderBrush="#444" BorderThickness="1" CornerRadius="8" Background="#2a2a2a">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="#1a1a1a" Padding="15" BorderBrush="#444" BorderThickness="0,0,0,1">
                            <TextBlock Text="ðŸ“œ Transaction History" 
                                       FontWeight="Bold" FontSize="16" Foreground="White"/>
                        </Border>

                        <DataGrid Grid.Row="1" Style="{StaticResource Section.DataGrid}"
                                  ItemsSource="{Binding Transactions}" 
                                  AutoGenerateColumns="False" 
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  Background="Transparent"
                                  RowBackground="#2a2a2a"
                                  AlternatingRowBackground="#333"
                                  BorderThickness="0"
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  FontSize="12">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#1a1a1a"/>
                                    <Setter Property="Foreground" Value="#BBB"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="8"/>
                                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                    <Setter Property="BorderBrush" Value="#444"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date" Binding="{Binding TransactionDate, StringFormat=dd-MMM}" Width="80"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding TransactionType, Converter={StaticResource EnumToFriendlyStringConverter}}" Width="140"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=â‚¹{0:N0}}" Width="90"/>
                                <DataGridTextColumn Header="Interest" Binding="{Binding InterestAmount, StringFormat=â‚¹{0:N0}}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </Grid>

            <!-- Loading Overlay -->
            <Border Grid.RowSpan="4" Background="#CC000000" 
                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="250" Height="6" Foreground="#0275d8"/>
                    <TextBlock Text="Loading..." Foreground="White" FontSize="18" Margin="0,15,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
