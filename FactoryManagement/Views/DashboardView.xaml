<UserControl x:Class="FactoryManagement.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Charts Grid -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Transaction Entry Chart -->
                <Border Grid.Row="0" Grid.Column="0" 
                        BorderBrush="#444" BorderThickness="1" 
                        CornerRadius="8" Background="#2a2a2a" 
                        Padding="20" Margin="0,0,0,12" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border Background="#4a90c8" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <TextBlock Text="ðŸ“¦" FontSize="20" Foreground="White" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Transaction Entry" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text="Purchases, Sales &amp; Wastage" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Chart -->
                        <Grid Grid.Row="1" Height="320">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Purchases Bar -->
                            <Grid Grid.Column="0" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalPurchases, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#4a90c8" Width="60" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource TransactionBarHeightConverter}">
                                            <Binding Path="TotalPurchases"/>
                                            <Binding Path="TotalSales"/>
                                            <Binding Path="TotalWastage"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Label -->
                                <TextBlock Grid.Row="2" Text="Purchases" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                            </Grid>

                            <!-- Sales Bar -->
                            <Grid Grid.Column="1" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalSales, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#3d8b5f" Width="60" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource TransactionBarHeightConverter2}">
                                            <Binding Path="TotalSales"/>
                                            <Binding Path="TotalPurchases"/>
                                            <Binding Path="TotalWastage"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Label -->
                                <TextBlock Grid.Row="2" Text="Sales" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                            </Grid>

                            <!-- Wastage Bar -->
                            <Grid Grid.Column="2" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalWastage, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#b85450" Width="60" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource TransactionBarHeightConverter3}">
                                            <Binding Path="TotalWastage"/>
                                            <Binding Path="TotalPurchases"/>
                                            <Binding Path="TotalSales"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Label -->
                                <TextBlock Grid.Row="2" Text="Wastage" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Financial Transactions Chart -->
                <Border Grid.Row="0" Grid.Column="2" 
                        BorderBrush="#444" BorderThickness="1" 
                        CornerRadius="8" Background="#2a2a2a" 
                        Padding="20" Margin="0,0,0,12" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border Background="#3d8b5f" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <TextBlock Text="ðŸ’°" FontSize="20" Foreground="White" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Financial Transactions" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text="Loans Given &amp; Taken" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Chart -->
                        <Grid Grid.Row="1" Height="320">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Loans Given Bar -->
                            <Grid Grid.Column="0" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalLoansGiven, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#3d8b5f" Width="70" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource LoanBarHeightConverter}">
                                            <Binding Path="TotalLoansGiven"/>
                                            <Binding Path="TotalLoansTaken"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Labels -->
                                <TextBlock Grid.Row="2" Text="Loans Given" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                                <TextBlock Grid.Row="3" Text="(Outstanding)" 
                                          Foreground="#666" FontSize="10"
                                          HorizontalAlignment="Center"/>
                            </Grid>

                            <!-- Loans Taken Bar -->
                            <Grid Grid.Column="1" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalLoansTaken, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#b85450" Width="70" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource LoanBarHeightConverter2}">
                                            <Binding Path="TotalLoansTaken"/>
                                            <Binding Path="TotalLoansGiven"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Labels -->
                                <TextBlock Grid.Row="2" Text="Loans Taken" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                                <TextBlock Grid.Row="3" Text="(Outstanding)" 
                                          Foreground="#666" FontSize="10"
                                          HorizontalAlignment="Center"/>
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Wages Management Chart -->
                <Border Grid.Row="0" Grid.Column="4" 
                        BorderBrush="#444" BorderThickness="1" 
                        CornerRadius="8" Background="#2a2a2a" 
                        Padding="20" Margin="0,0,0,12" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border Background="#d9a05b" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <TextBlock Text="ðŸ‘·" FontSize="20" Foreground="White" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Wages Management" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text="Wages Paid &amp; Advances Given" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Chart -->
                        <Grid Grid.Row="1" Height="320">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Wages Paid Bar -->
                            <Grid Grid.Column="0" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalWagesPaid, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#d9a05b" Width="70" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource WageBarHeightConverter}">
                                            <Binding Path="TotalWagesPaid"/>
                                            <Binding Path="TotalAdvancesGiven"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Label -->
                                <TextBlock Grid.Row="2" Text="Wages Paid" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                            </Grid>

                            <!-- Advances Given Bar -->
                            <Grid Grid.Column="1" Margin="10,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Amount Label -->
                                <TextBlock Grid.Row="0" Text="{Binding TotalAdvancesGiven, StringFormat='â‚¹{0:N0}'}" 
                                          Foreground="White" FontWeight="Bold" FontSize="12"
                                          HorizontalAlignment="Center" Margin="0,0,0,4"/>

                                <!-- Bar -->
                                <Border Grid.Row="1" VerticalAlignment="Bottom" CornerRadius="6,6,0,0" 
                                       Background="#4a90c8" Width="70" HorizontalAlignment="Center">
                                    <Border.Height>
                                        <MultiBinding Converter="{StaticResource WageBarHeightConverter2}">
                                            <Binding Path="TotalAdvancesGiven"/>
                                            <Binding Path="TotalWagesPaid"/>
                                        </MultiBinding>
                                    </Border.Height>
                                </Border>

                                <!-- Label -->
                                <TextBlock Grid.Row="2" Text="Advances Given" 
                                          Foreground="#AAA" FontSize="12" FontWeight="SemiBold"
                                          HorizontalAlignment="Center" Margin="0,8,0,4"/>
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Recent Entries -->
                <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" 
                        BorderBrush="#444" BorderThickness="1" 
                        CornerRadius="8" Background="#2a2a2a" 
                        Padding="20" Margin="0,0,12,0">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border Background="#4a90c8" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <TextBlock Text="ðŸ“‹" FontSize="20" Foreground="White" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Recent Entries" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text="Latest activities across all transaction types" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <DataGrid ItemsSource="{Binding RecentActivities}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                IsReadOnly="True"
                                Background="Transparent"
                                RowBackground="#1e2538"
                                AlternatingRowBackground="#1a2030"
                                BorderThickness="0"
                                GridLinesVisibility="None"
                                HeadersVisibility="Column"
                                SelectionMode="Single">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                    <Setter Property="Background" Value="#16213e"/>
                                    <Setter Property="Foreground" Value="#C0C0C0"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="8,6"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="#4a5568"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                                    <Setter Property="Foreground" Value="#E8E8E8"/>
                                    <Setter Property="Height" Value="40"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#252d45"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#2d3548"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="8,0"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderThickness="0" 
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat=dd/MM/yyyy}" Width="85"/>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="90">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="110"/>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                                <DataGridTextColumn Header="Party" Binding="{Binding Party}" Width="120"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat='â‚¹ {0:N0}'}" Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Foreground" Value="{StaticResource AccentCyan}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </Border>

                <!-- Stock Levels Chart -->
                <Border Grid.Row="1" Grid.Column="4" 
                        BorderBrush="#444" BorderThickness="1" 
                        CornerRadius="8" Background="#2a2a2a" 
                        Padding="20" VerticalAlignment="Top">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border Background="#b85450" Width="36" Height="36" CornerRadius="8" Margin="0,0,12,0">
                                <TextBlock Text="ðŸ“Š" FontSize="20" Foreground="White" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Stock Levels" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text="Current Inventory Status" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Stock List -->
                        <Grid Grid.Row="1">
                            <ItemsControl ItemsSource="{Binding AllItems}" VerticalAlignment="Top">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="0,8" BorderBrush="#3a3a3a" BorderThickness="0,0,0,1">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                
                                                <!-- Item Name and Stock Value -->
                                                <DockPanel Grid.Row="0" Margin="0,0,0,6">
                                                    <TextBlock DockPanel.Dock="Left"
                                                             Text="{Binding ItemName}" 
                                                             FontWeight="SemiBold"
                                                             FontSize="12"
                                                             Foreground="White"
                                                             VerticalAlignment="Center"/>
                                                    <TextBlock DockPanel.Dock="Right"
                                                             HorizontalAlignment="Right"
                                                             VerticalAlignment="Center">
                                                        <Run Text="{Binding CurrentStock, StringFormat=N0, Mode=OneWay}" 
                                                             FontWeight="Bold"
                                                             FontSize="12"
                                                             Foreground="#4a90c8"/>
                                                        <Run Text=" " />
                                                        <Run Text="{Binding Unit, Mode=OneWay}" 
                                                             Foreground="{StaticResource TextSecondary}"
                                                             FontSize="10"/>
                                                    </TextBlock>
                                                </DockPanel>
                                                
                                                <!-- Visual Stock Bar -->
                                                <Border Grid.Row="1" 
                                                       Background="#1a1a1a" 
                                                       CornerRadius="4"
                                                       Height="6">
                                                    <Border.Clip>
                                                        <RectangleGeometry RadiusX="4" RadiusY="4">
                                                            <RectangleGeometry.Rect>
                                                                <MultiBinding Converter="{StaticResource StockToRectConverter}">
                                                                    <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Border}"/>
                                                                    <Binding Path="ActualHeight" RelativeSource="{RelativeSource AncestorType=Border}"/>
                                                                </MultiBinding>
                                                            </RectangleGeometry.Rect>
                                                        </RectangleGeometry>
                                                    </Border.Clip>
                                                    <Grid>
                                                        <Border HorizontalAlignment="Left" CornerRadius="4">
                                                            <Border.Width>
                                                                <MultiBinding Converter="{StaticResource StockBarWidthConverter}">
                                                                    <Binding Path="CurrentStock"/>
                                                                    <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Border, AncestorLevel=2}"/>
                                                                </MultiBinding>
                                                            </Border.Width>
                                                            <Border.Background>
                                                                <MultiBinding Converter="{StaticResource StockLevelColorConverter}">
                                                                    <Binding Path="CurrentStock"/>
                                                                </MultiBinding>
                                                            </Border.Background>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>

            <!-- Loading Overlay -->
            <Grid Grid.RowSpan="1" Background="#80000000" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                           Value="0"
                           IsIndeterminate="True"
                           Width="60" Height="60"/>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>
