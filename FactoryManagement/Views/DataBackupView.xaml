<UserControl x:Class="FactoryManagement.Views.DataBackupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="Transparent">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Summary Cards Section -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Backup Folder Location Card -->
            <materialDesign:Card Grid.Column="0" Padding="20" Style="{StaticResource ModernCard}" Background="#2a2a2a">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:PackIcon Grid.Column="0" 
                                           Kind="Folder" 
                                           Width="28" 
                                           Height="28" 
                                           VerticalAlignment="Center"
                                           Margin="0,0,16,0"
                                           Foreground="#64B5F6"/>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="Backup Folder Location" 
                                 FontSize="12" 
                                 Foreground="{StaticResource TextSecondary}"
                                 Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding BackupPath}" 
                                 FontSize="14" 
                                 FontWeight="Medium"
                                 Foreground="White"
                                 TextTrimming="CharacterEllipsis"
                                 TextWrapping="NoWrap"/>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>

            <!-- Browse Button Card -->
            <materialDesign:Card Grid.Column="2" Padding="20" Style="{StaticResource ModernCard}" Background="#2a2a2a">
                <Button Command="{Binding BrowseBackupFolderCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Height="40"
                        Padding="20,0"
                        Foreground="White"
                        ToolTip="Browse and select a different folder for storing backups">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="FolderSearch" Width="20" Height="20" VerticalAlignment="Center"/>
                        <TextBlock Text="Change Folder" Margin="10,0,0,0" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </Button>
            </materialDesign:Card>
        </Grid>

        <!-- Action Buttons -->
        <materialDesign:Card Grid.Row="1" Margin="0,0,0,20" Padding="24" Style="{StaticResource ModernCard}" Background="#2a2a2a">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Command="{Binding CreateBackupCommand}"
                            Margin="0,0,12,0"
                            Height="44"
                            Padding="20,0"
                            Style="{StaticResource Button.Primary}"
                            ToolTip="Create a new backup of the database. Backup files are timestamped and saved to the Backups folder">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="BackupRestore" Width="20" Height="20" VerticalAlignment="Center"/>
                            <TextBlock Text="Create Backup" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding RestoreBackupCommand}"
                            Margin="0,0,12,0"
                            Height="44"
                            Padding="20,0"
                            Style="{StaticResource Button.Success}"
                            ToolTip="Restore the database from the selected backup file. WARNING: This will replace all current data with the backup data">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="DatabaseImport" Width="20" Height="20" VerticalAlignment="Center"/>
                            <TextBlock Text="Restore Selected" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DeleteBackupCommand}"
                            Margin="0,0,12,0"
                            Height="44"
                            Padding="20,0"
                            Style="{StaticResource Button.Danger}"
                            ToolTip="Permanently delete the selected backup file. This action cannot be undone">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Delete" Width="20" Height="20" VerticalAlignment="Center"/>
                            <TextBlock Text="Delete Selected" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Command="{Binding RefreshBackupsCommand}"
                            Margin="0,0,12,0"
                            Height="44"
                            Padding="20,0"
                            Foreground="White"
                            ToolTip="Refresh the list of available backup files">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" Width="20" Height="20" VerticalAlignment="Center"/>
                            <TextBlock Text="Refresh" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Command="{Binding OpenBackupFolderCommand}"
                            Height="44"
                            Padding="20,0"
                            Foreground="White"
                            ToolTip="Open the Backups folder in Windows Explorer to view or manually manage backup files">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FolderOpen" Width="20" Height="20" VerticalAlignment="Center"/>
                            <TextBlock Text="Open Folder" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Backup List -->
        <materialDesign:Card Grid.Row="2" Style="{StaticResource ModernCard}" Background="#2a2a2a">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- Header using global section header style, ensure proper alignment -->
                <Border Grid.Row="0" Style="{StaticResource SectionHeader.Prominent}" HorizontalAlignment="Stretch" Margin="0">
                    <StackPanel Style="{StaticResource SectionHeader}" Margin="0">
                        <Border Style="{StaticResource IconBadge}" Background="{StaticResource Card.Info}">
                            <materialDesign:PackIcon Kind="DatabaseClock" Width="20" Height="20" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Style="{StaticResource SectionHeader.Content}">
                            <TextBlock Text="Available Backups" Style="{StaticResource SectionHeader.Title}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Backup DataGrid -->
                <DataGrid
                    Style="{StaticResource Section.DataGrid}"
                    Grid.Row="1"
                    ItemsSource="{Binding Backups}"
                    SelectedItem="{Binding SelectedBackup}">
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource DataGrid.Dark.Header}"/>
                    </DataGrid.ColumnHeaderStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="File Name" 
                                          Binding="{Binding FileName}" 
                                          Width="*"
                                          FontSize="14">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="Medium"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Created Date" 
                                          Binding="{Binding FormattedDate}" 
                                          Width="200"
                                          FontSize="14"/>

                        <DataGridTextColumn Header="Size" 
                                          Binding="{Binding FormattedSize}" 
                                          Width="120"
                                          FontSize="14">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{StaticResource AccentCyan}"/>
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </materialDesign:Card>

        <!-- Status Bar -->
        <materialDesign:Card Grid.Row="3" Margin="0,20,0,0" Padding="20,16">
            <DockPanel>
                <materialDesign:PackIcon Kind="Information" 
                                       Width="20" 
                                       Height="20" 
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0"
                                       Foreground="#64B5F6"/>
                <TextBlock Text="{Binding StatusMessage}" 
                          VerticalAlignment="Center"
                          FontSize="14"/>
                
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                           IsIndeterminate="True"
                           Width="20"
                           Height="20"
                           HorizontalAlignment="Right"
                           Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </DockPanel>
        </materialDesign:Card>
    </Grid>
</UserControl>

